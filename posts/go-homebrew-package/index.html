<!doctype html><html lang=en-au><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Go Homebrew Package</title><meta name=description content="Go is an excellent language for writing command line tools, and Homebrew is the de facto package manager for macOS. This guide provides step by step instructions on how to get from go source code to published homebrew package."><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.min.2f3c103fa8fba547d44ff06450ec14f9a1a78f1c9e3d86563f5a7a65deb9d533.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.min.ed9c7cd194015925a89f5bfe67478b33b4fc704b0cf365d471e4038bea1e86e9.png><link rel=apple-touch-icon sizes=57x57 href=/favicon-57x57.min.bc4af4dde79b339b790a4729be9235088e00e41998f449925135902b848e7216.png><link rel=icon type=image/png href=/favicon-57x57.min.bc4af4dde79b339b790a4729be9235088e00e41998f449925135902b848e7216.png sizes=57x57><link rel=apple-touch-icon sizes=60x60 href=/favicon-60x60.min.432c1b1bf69e7ce7a47f079ab6409e2298502c486f60652e29656593c54fd9e2.png><link rel=apple-touch-icon sizes=72x72 href=/favicon-72x72.min.95d92c4cfb955ffd30b67aacd76127312db5fcf0036d24ad087a3a65aace11a2.png><link rel=apple-touch-icon sizes=76x76 href=/favicon-76x76.min.c8b2eb83eb65f8b5d05ed842c946e84d2415cacf4b7418a2e5c7483202cd8d8a.png><link rel=icon type=image/png href=/favicon-76x76.min.c8b2eb83eb65f8b5d05ed842c946e84d2415cacf4b7418a2e5c7483202cd8d8a.png sizes=76x76><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.min.c0961a76766b7fff4ccc323a207d72cbbdb800b05669725baf06ce206c8681f6.png><link rel=apple-touch-icon sizes=114x114 href=/favicon-114x114.min.cdeca5756cbe961454fc1161608f8de20857bb7d659c6441904ab6ad40c51f13.png><link rel=apple-touch-icon sizes=120x120 href=/favicon-120x120.min.13b4ffce0c544d94669e3fb8bcfcbf103248e84dc06c8fbd3a7c7899a652090e.png><link rel=icon type=image/png href=/favicon-128x128.min.ed9d63a2795cba040089698dc4f35f45fd9795ee71ae6f7bd1347ba64e5600ec.png sizes=128x128><link rel=apple-touch-icon sizes=144x144 href=/favicon-144x144.min.7d7d1c79c6335c7b470c2c38aa72974878be930327ffb42781cac4e09c2dfedd.png><meta name=msapplication-TileImage content="/favicon-144x144.min.7d7d1c79c6335c7b470c2c38aa72974878be930327ffb42781cac4e09c2dfedd.png"><link rel=apple-touch-icon sizes=152x152 href=/favicon-152x152.min.1d9fe3164eada992cb205fb4a19a9fbf7f5a30e34c943f5b3f8c136a4669c632.png><link rel=apple-touch-icon sizes=180x180 href=/favicon-180x180.min.c900a657ee1444d9df4d486c99839cf3826568e454aa84e3a0b9e4fd81bdc86a.png><link rel=icon type=image/png sizes=192x192 href=/favicon-192x192.min.079e5370797cbd2da7147a23495e27d757d45ebba7778fce946f7f067ff2f7fc.png><link rel="shortcut icon" sizes=196x196 href=/favicon-196x196.min.0c902b6c723e262bb182fdca6961cc5d5822b306becd08d1a68df148fbb57fa1.png><link rel=icon type=image/png sizes=228x228 href=/favicon-228x228.min.b3b4d1c03ef473d4f91f3846714c4e1c6761dc05522a788cbb2da6db88ec19e8.png><link rel=manifest href=/site.9d3ddd355181d1286059dd015e23b7389cf87488bebaa3c8f7c6cabca78074d1.webmanifest><link rel=stylesheet href=/app.min.de387f24c1f0506ad8b1cb84ee3f6f3286815efe619e0d1b0d5b845d2dfbb51e.css><link rel=sitemap type=application/xml href=https://tedman.dev/sitemap.xml><link rel=alternate type=application/rss+xml href=https://tedman.dev/rss.xml title="Daniel Tedman"><link type=text/plain rel=author href=https://tedman.dev/humans.txt><script defer src=https://cloud.umami.is/script.js crossorigin=anonymous data-website-id=b9e86c3d-5242-45d7-bb0d-96106efe9149></script></head><body><main><article><nav class=breadcrumbs><a href=/>Home</a>
<span>//</span>
<span>Posts</span></nav><h1>Go Homebrew Package</h1><div class=metadata><div class=date>October 23, 2023</div><div class=topics><a href=https://tedman.dev/topics/github-actions/>GitHub Actions</a><a href=https://tedman.dev/topics/go/>Go</a><a href=https://tedman.dev/topics/go-releaser/>Go Releaser</a><a href=https://tedman.dev/topics/guide/>Guide</a><a href=https://tedman.dev/topics/homebrew/>Homebrew</a></div></div><section class=abstract><p>Go is an excellent language for writing command line tools, and Homebrew is the de facto package manager for macOS. This guide provides step by step instructions on how to get from go source code to published homebrew package.</p></section><section class=toc><nav id=TableOfContents><ul><li><a href=#goal>Goal</a></li><li><a href=#assumptions>Assumptions</a></li><li><a href=#go-releaser-build>Go Releaser Build</a></li><li><a href=#github-actions-ci>GitHub Actions CI</a></li><li><a href=#homebrew-tap>Homebrew Tap</a></li><li><a href=#go-releaser-release>Go Releaser Release</a></li><li><a href=#github-actions-release>GitHub Actions Release</a></li><li><a href=#github-actions-repository-secret>GitHub Actions Repository Secret</a></li><li><a href=#tag-release>Tag Release</a></li><li><a href=#test>Test</a></li><li><a href=#complete-solution>Complete Solution</a></li></ul></nav></section><section><h2 id=goal>Goal</h2><p>To allow for installing our go binary <code>aquamarine</code> on macOS using Homebrew.</p><h2 id=assumptions>Assumptions</h2><ul><li>A go project exists with a functional binary.</li><li>GitHub Actions will be used for automating the release.</li><li>Go Releaser will be used to coordinate the go build.</li><li>A Homebrew Tap will be used, instead of publishing via the <a href=https://github.com/Homebrew/homebrew-core>homebrew-core</a>
repository.</li></ul><h2 id=go-releaser-build>Go Releaser Build</h2><p><a href=https://goreleaser.com>GoReleaser (goreleaser.com)</a> is used to automate build and release processes, for a multi-os, multi-architecture Go binary.</p><p>To configure GoReleaser, begin by creating a <code>.goreleaser.yml</code> file based on the following template:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>before</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;go mod tidy&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>builds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aquamarine&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>binary</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aquamarine&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Path to the main.go for the binary you want to compile.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>main</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cmd/aquamarine/main.go&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Build a statically-linked binary without external dependencies.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;CGO_ENABLED=0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mod_timestamp</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .CommitTimestamp }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>flags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Remove all file system paths from the resulting executable.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-trimpath&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ldflags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Omit the symbol table and debug information.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Omit the DWARF symbol table.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-w&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Populate build information into version variables. In this example,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># the aquamarine binary embeds the current build details, so we need</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># to provide them in the following lines.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-X github.com/dbtedman/conveyance/cmd.version={{.Version}}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-X github.com/dbtedman/conveyance/cmd.commit={{.Commit}}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;-X github.com/dbtedman/conveyance/cmd.date={{.CommitDate}}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>goos</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Choose the operating systems you want to target.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;linux&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;darwin&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;windows&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>goarch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Choose the architectures you want to target.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;amd64&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;arm64&#34;</span><span class=w>
</span></span></span></code></pre></div><h2 id=github-actions-ci>GitHub Actions CI</h2><p>We want to build our binary automatically on commits to our code repository, we are using <a href=https://docs.github.com/en/actions>GitHub Actions (docs.github.com)</a> for this purpose.</p><p>In your code repository, create a GitHub Actions workflow configuration <code>.github/workflows/ci.yml</code>, based on the following template:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ci&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;main&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;main&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>permissions</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;read-all&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>linux</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ubuntu-latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Checkout Code&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;actions/checkout@4.1.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Setup Go&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;actions/setup-go@4.1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=c># Go version in use will be selected based on your module definition.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>go-version-file</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./go.mod&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Build&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;goreleaser/goreleaser-action@5.0.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;build --clean --snapshot&#34;</span><span class=w>
</span></span></span></code></pre></div><p>This configuration will cause a pipeline to execute on each commit to the <code>main</code> branch, or any Pull Requests that target <code>main</code> branch.</p><p>Push the changes to your remote repository, and confirm in the GitHub UI that a pipeline has been executed.</p><h2 id=homebrew-tap>Homebrew Tap</h2><p>A Homebrew Tap provides an alternative to publishing to the primary Homebrew repository, in a code repository you control.</p><p>Create an empty repository <a href=https://github.com/dbtedman/homebrew-tap>github.com/dbtedman/homebrew-tap</a> for this purpose.</p><blockquote><p>💡 It is important to name the repository <code>homebrew-tap</code> as this is expected by the <code>brew install</code> command so that the formula can be referenced as <code>dbtedman/tap/aquamarine</code>.</p></blockquote><h2 id=go-releaser-release>Go Releaser Release</h2><p>Now that we can build our binary in our pipeline, we need to prepare our GoReleaser configuration for publishing to Homebrew.</p><p>Modify your GoReleaser configuration <code>.goreleaser.yml</code>, according to the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>archives</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;binary&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aquamarine_binary&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>builds</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;aquamarine&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aquamarine_{{ .Version }}_{{ .Os }}_{{ .Arch }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>format</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zip&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;zip&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .Binary }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>checksum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name_template</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .ProjectName }}_{{ .Version }}_SHA256SUMS&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>algorithm</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;sha256&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>brews</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aquamarine&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ids</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;aquamarine_binary&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Configuration for the homebrew tap created in the previous step.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>repository</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>owner</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;dbtedman&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;homebrew-tap&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;main&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>homepage</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://github.com/dbtedman/stop&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Provide security by proxying requests to legacy applications.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>license</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;MIT&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>folder</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Formula&#34;</span><span class=w>
</span></span></span></code></pre></div><h2 id=github-actions-release>GitHub Actions Release</h2><p>We want to release our binary automatically on tags in our code repository, as was done for builds, we are using GitHub Actions for this purpose.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;release&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>permissions</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;read-all&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ubuntu-latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>permissions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;write&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Checkout Code&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;actions/checkout@4.1.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Setup Go&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;actions/setup-go@4.1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=c># Go version in use will be selected based on your module definition.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>go-version-file</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./go.mod&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Release&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;goreleaser/goreleaser-action@5.0.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;release&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;release --clean&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=c># Needed so that GoReleaser can publish release artifacts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=c># to GitHub, and create a release.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GITHUB_TOKEN }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>HOMEBREW_TAP_GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.HOMEBREW_TAP_GITHUB_TOKEN }}</span><span class=w>
</span></span></span></code></pre></div><h2 id=github-actions-repository-secret>GitHub Actions Repository Secret</h2><p>To authenticate GoReleaser to publish to our Homebrew Tap, you will need to create a <a href=https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token>Fine-grained Personal Access Token (docs.github.com)</a>:</p><table><thead><tr><th>Option</th><th>Usage</th></tr></thead><tbody><tr><td>Name</td><td><code>HOMEBREW_TAP_GITHUB_TOKEN</code></td></tr><tr><td>Access on</td><td><strong>Only select repositories</strong>, and select the HomeBrew Tap <code>dbtedman/homebrew-tap</code></td></tr><tr><td>Permissions</td><td><strong>Contents (Read/Write)</strong>, and <strong>Metadata (Read Only)</strong></td></tr></tbody></table><p>Keep a record of the token that is generated.</p><p>In the code repository for your go binary, define a <a href=https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions>Repository Secret (docs.github.com)</a> <code>HOMEBREW_TAP_GITHUB_TOKEN</code> with the value of the token just generated.</p><h2 id=tag-release>Tag Release</h2><p>Create a release tag, and push to the remote repository. This will automatically trigger a release pipeline.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git tag 0.1.0 <span class=o>&amp;&amp;</span> git push origin 0.1.0
</span></span></code></pre></div><h2 id=test>Test</h2><p>We are now ready to test our published Homebrew Formula. Install <code>aquamarine</code> using the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>brew install dbtedman/tap/aquamarine
</span></span></code></pre></div><h2 id=complete-solution>Complete Solution</h2><p>You can see the full solution on GitHub <a href=https://github.com/dbtedman/stop>github.com/dbtedman/stop</a>, along with other
go based experiments.</p></section></article></main><footer><p class=font-usage>This site uses <a href=https://tedman.dev/posts/atkinson-hyperlegible/>Atkinson Hyperlegible</a> to ensure content is accessible to as many people as possible.</p><nav><a href=https://tedman.dev/topics>topics</a>
<a href=https://tedman.dev/rss.xml>rss</a>
<a href=https://tedman.dev/.well-known/security.txt>security.txt</a>
<a href=https://tedman.dev/humans.txt>humans.txt</a>
<a href=https://github.com/dbtedman/tedman.dev/blob/main/LICENSE.md>license</a></nav></footer></body></html>